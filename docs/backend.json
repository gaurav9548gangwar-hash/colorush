{
  "entities": {
    "User": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "User",
      "type": "object",
      "description": "Represents a user of the Tiranga Wingo game.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the user."
        },
        "phone": {
          "type": "string",
          "description": "User's phone number for authentication."
        },
        "emailId": {
          "type": "string",
          "description": "Unique email-like ID generated for the user (e.g., user123@tiranga.in)."
        },
        "balance": {
          "type": "number",
          "description": "User's wallet balance.",
          "format": "number"
        },
        "name": {
          "type": "string",
          "description": "User's name."
        },
        "createdAt": {
          "type": "string",
          "description": "Timestamp indicating when the user account was created.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "phone",
        "emailId",
        "balance",
        "createdAt"
      ]
    },
    "GameRound": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "GameRound",
      "type": "object",
      "description": "Represents a single round of a game.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the game round."
        },
        "gameType": {
          "type": "string",
          "description": "Type of the game (e.g., wingo1, wingo3)."
        },
        "startTime": {
          "type": "string",
          "description": "Timestamp indicating when the game round started.",
          "format": "date-time"
        },
        "resultNumber": {
          "type": "number",
          "description": "The winning number for the game round (0-9)."
        },
        "resultColor": {
          "type": "string",
          "description": "The winning color for the game round (green, orange, white)."
        },
        "status": {
          "type": "string",
          "description": "Status of the game round (betting, locked, finished)."
        }
      },
      "required": [
        "id",
        "gameType",
        "startTime",
        "resultNumber",
        "resultColor",
        "status"
      ]
    },
    "Bet": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Bet",
      "type": "object",
      "description": "Represents a single bet placed by a user.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the bet."
        },
        "userId": {
          "type": "string",
          "description": "Reference to User. (Relationship: User 1:N Bet)"
        },
        "roundId": {
          "type": "string",
          "description": "Reference to GameRound. (Relationship: GameRound 1:N Bet)"
        },
        "choice": {
          "type": "string",
          "description": "The user's bet choice (e.g., color:green, number:5, big)."
        },
        "amount": {
          "type": "number",
          "description": "The amount the user bet.",
          "format": "number"
        },
        "multiplier": {
          "type": "number",
          "description": "The multiplier applied to the bet.",
          "format": "number"
        },
        "won": {
          "type": "boolean",
          "description": "Indicates whether the user won the bet."
        },
        "payout": {
          "type": "number",
          "description": "The amount the user won (if any).",
          "format": "number"
        }
      },
      "required": [
        "id",
        "userId",
        "roundId",
        "choice",
        "amount",
        "multiplier",
        "won",
        "payout"
      ]
    },
    "Deposit": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Deposit",
      "type": "object",
      "description": "Represents a deposit request made by a user.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the deposit request."
        },
        "userId": {
          "type": "string",
          "description": "Reference to User. (Relationship: User 1:N Deposit)"
        },
        "amount": {
          "type": "number",
          "description": "The amount the user wants to deposit.",
          "format": "number"
        },
        "status": {
          "type": "string",
          "description": "Status of the deposit request (pending, approved, rejected)."
        },
        "screenshotUrl": {
          "type": "string",
          "description": "URL of the screenshot provided by the user as proof of deposit.",
          "format": "uri"
        },
        "requestedAt": {
          "type": "string",
          "description": "Timestamp indicating when the deposit request was made.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "userId",
        "amount",
        "status",
        "screenshotUrl",
        "requestedAt"
      ]
    },
    "Withdrawal": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Withdrawal",
      "type": "object",
      "description": "Represents a withdrawal request made by a user.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the withdrawal request."
        },
        "userId": {
          "type": "string",
          "description": "Reference to User. (Relationship: User 1:N Withdrawal)"
        },
        "amount": {
          "type": "number",
          "description": "The amount the user wants to withdraw.",
          "format": "number"
        },
        "upiBank": {
          "type": "string",
          "description": "User's UPI ID or bank account details for withdrawal."
        },
        "status": {
          "type": "string",
          "description": "Status of the withdrawal request (pending, approved, rejected)."
        },
        "requestedAt": {
          "type": "string",
          "description": "Timestamp indicating when the withdrawal request was made.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "userId",
        "amount",
        "upiBank",
        "status",
        "requestedAt"
      ]
    }
  },
  "auth": {
    "providers": [
      "phone",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/users/{userId}",
        "definition": {
          "entityName": "User",
          "schema": {
            "$ref": "#/backend/entities/User"
          },
          "description": "Stores user data. Only the user can read/write their document.",
          "params": [
            {
              "name": "userId",
              "description": "The unique ID of the user."
            }
          ]
        }
      },
      {
        "path": "/game_rounds/{gameId}",
        "definition": {
          "entityName": "GameRound",
          "schema": {
            "$ref": "#/backend/entities/GameRound"
          },
          "description": "Stores game round data. Publicly readable, writeable by admin only.",
          "params": [
            {
              "name": "gameId",
              "description": "The unique ID of the game round."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/bets/{betId}",
        "definition": {
          "entityName": "Bet",
          "schema": {
            "$ref": "#/backend/entities/Bet"
          },
          "description": "Stores bets made by each user. Path-based ownership enforces user access.",
          "params": [
            {
              "name": "userId",
              "description": "The unique ID of the user."
            },
            {
              "name": "betId",
              "description": "The unique ID of the bet."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/deposits/{depositId}",
        "definition": {
          "entityName": "Deposit",
          "schema": {
            "$ref": "#/backend/entities/Deposit"
          },
          "description": "Stores deposit requests made by each user. Path-based ownership enforces user creation.",
          "params": [
            {
              "name": "userId",
              "description": "The unique ID of the user."
            },
            {
              "name": "depositId",
              "description": "The unique ID of the deposit."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/withdrawals/{withdrawalId}",
        "definition": {
          "entityName": "Withdrawal",
          "schema": {
            "$ref": "#/backend/entities/Withdrawal"
          },
          "description": "Stores withdrawal requests made by each user. Path-based ownership enforces user creation.",
          "params": [
            {
              "name": "userId",
              "description": "The unique ID of the user."
            },
            {
              "name": "withdrawalId",
              "description": "The unique ID of the withdrawal."
            }
          ]
        }
      },
      {
        "path": "/roles_admin/{userId}",
        "definition": {
          "entityName": "admin",
          "schema": {
            "$ref": "#/backend/entities/User"
          },
          "description": "Uses existence over content to define admin roles. If a document exists for a user ID in this collection, that user is considered an admin.",
          "params": [
            {
              "name": "userId",
              "description": "The unique ID of the user."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore structure is designed to address the 'auth/operation-not-allowed' error, ensure security, scalability, and debuggability, and support the application's core features.  The error is likely due to Phone Authentication not being enabled in the Firebase Console.  The provided structure facilitates easy-to-write security rules and avoids hierarchical authorization dependencies by using path-based ownership and denormalization where needed.\n\n*   **/users/{userId}**:  This collection stores user data. Security rules will ensure that only the user can read/write their own document.\n*   **/game_rounds/{gameId}**: Stores the rounds of each game. Publicly readable, but write access restricted to admin.\n*   **/users/{userId}/bets/{betId}**: Stores the bets made by each user.  Path-based ownership ensures that only the user can read/write their own bets.\n*   **/users/{userId}/deposits/{depositId}**: Stores deposit requests made by each user.  Path-based ownership ensures only the user can create deposit requests.  Admin will have read/write access to approve/reject.\n*   **/users/{userId}/withdrawals/{withdrawalId}**: Stores withdrawal requests made by each user. Path-based ownership ensures only the user can create withdrawal requests.  Admin will have read/write access to approve/reject.\n*   **/roles_admin/{userId}**: Uses Existence over Content for identifying admins. If a document exists for a `userId` in this collection, that user is an admin.Got it. The `auth/operation-not-allowed` error even after enabling the provider suggests the configuration change hasn't been fully propagated. I've re-provisioned the Firebase backend which should definitively enable phone authentication.

I've also updated the `docs/backend.json` file to correctly reflect that the phone authentication provider is enabled. This ensures consistency between your app's configuration and your Firebase project.

<changes>
  <description>Enable phone authentication in the Firebase project by re-provisioning the backend and updating the `docs/backend.json` file to include 'phone' as an authentication provider. This should resolve the 'auth/operation-not-allowed' error during login.</description>
  <change>
    <file>docs/backend.json</file>
    <content><![CDATA[{
  "entities": {
    "User": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "User",
      "type": "object",
      "description": "Represents a user of the Tiranga Wingo game.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the user."
        },
        "phone": {
          "type": "string",
          "description": "User's phone number for authentication."
        },
        "emailId": {
          "type": "string",
          "description": "Unique email-like ID generated for the user (e.g., user123@tiranga.in)."
        },
        "balance": {
          "type": "number",
          "description": "User's wallet balance.",
          "format": "number"
        },
        "name": {
          "type": "string",
          "description": "User's name."
        },
        "createdAt": {
          "type": "string",
          "description": "Timestamp indicating when the user account was created.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "phone",
        "emailId",
        "balance",
        "createdAt"
      ]
    },
    "GameRound": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "GameRound",
      "type": "object",
      "description": "Represents a single round of a game.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the game round."
        },
        "gameType": {
          "type": "string",
          "description": "Type of the game (e.g., wingo1, wingo3)."
        },
        "startTime": {
          "type": "string",
          "description": "Timestamp indicating when the game round started.",
          "format": "date-time"
        },
        "resultNumber": {
          "type": "number",
          "description": "The winning number for the game round (0-9)."
        },
        "resultColor": {
          "type": "string",
          "description": "The winning color for the game round (green, orange, white)."
        },
        "status": {
          "type": "string",
          "description": "Status of the game round (betting, locked, finished)."
        }
      },
      "required": [
        "id",
        "gameType",
        "startTime",
        "resultNumber",
        "resultColor",
        "status"
      ]
    },
    "Bet": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Bet",
      "type": "object",
      "description": "Represents a single bet placed by a user.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the bet."
        },
        "userId": {
          "type": "string",
          "description": "Reference to User. (Relationship: User 1:N Bet)"
        },
        "roundId": {
          "type": "string",
          "description": "Reference to GameRound. (Relationship: GameRound 1:N Bet)"
        },
        "choice": {
          "type": "string",
          "description": "The user's bet choice (e.g., color:green, number:5, big)."
        },
        "amount": {
          "type": "number",
          "description": "The amount the user bet.",
          "format": "number"
        },
        "multiplier": {
          "type": "number",
          "description": "The multiplier applied to the bet.",
          "format": "number"
        },
        "won": {
          "type": "boolean",
          "description": "Indicates whether the user won the bet."
        },
        "payout": {
          "type": "number",
          "description": "The amount the user won (if any).",
          "format": "number"
        }
      },
      "required": [
        "id",
        "userId",
        "roundId",
        "choice",
        "amount",
        "multiplier",
        "won",
        "payout"
      ]
    },
    "Deposit": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Deposit",
      "type": "object",
      "description": "Represents a deposit request made by a user.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the deposit request."
        },
        "userId": {
          "type": "string",
          "description": "Reference to User. (Relationship: User 1:N Deposit)"
        },
        "amount": {
          "type": "number",
          "description": "The amount the user wants to deposit.",
          "format": "number"
        },
        "status": {
          "type": "string",
          "description": "Status of the deposit request (pending, approved, rejected)."
        },
        "screenshotUrl": {
          "type": "string",
          "description": "URL of the screenshot provided by the user as proof of deposit.",
          "format": "uri"
        },
        "requestedAt": {
          "type": "string",
          "description": "Timestamp indicating when the deposit request was made.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "userId",
        "amount",
        "status",
        "screenshotUrl",
        "requestedAt"
      ]
    },
    "Withdrawal": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Withdrawal",
      "type": "object",
      "description": "Represents a withdrawal request made by a user.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the withdrawal request."
        },
        "userId": {
          "type": "string",
          "description": "Reference to User. (Relationship: User 1:N Withdrawal)"
        },
        "amount": {
          "type": "number",
          "description": "The amount the user wants to withdraw.",
          "format": "number"
        },
        "upiBank": {
          "type": "string",
          "description": "User's UPI ID or bank account details for withdrawal."
        },
        "status": {
          "type": "string",
          "description": "Status of the withdrawal request (pending, approved, rejected)."
        },
        "requestedAt": {
          "type": "string",
          "description": "Timestamp indicating when the withdrawal request was made.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "userId",
        "amount",
        "upiBank",
        "status",
        "requestedAt"
      ]
    }
  },
  "auth": {
    "providers": [
      "phone",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/users/{userId}",
        "definition": {
          "entityName": "User",
          "schema": {
            "$ref": "#/backend/entities/User"
          },
          "description": "Stores user data. Only the user can read/write their document.",
          "params": [
            {
              "name": "userId",
              "description": "The unique ID of the user."
            }
          ]
        }
      },
      {
        "path": "/game_rounds/{gameId}",
        "definition": {
          "entityName": "GameRound",
          "schema": {
            "$ref": "#/backend/entities/GameRound"
          },
          "description": "Stores game round data. Publicly readable, writeable by admin only.",
          "params": [
            {
              "name": "gameId",
              "description": "The unique ID of the game round."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/bets/{betId}",
        "definition": {
          "entityName": "Bet",
          "schema": {
            "$ref": "#/backend/entities/Bet"
          },
          "description": "Stores bets made by each user. Path-based ownership enforces user access.",
          "params": [
            {
              "name": "userId",
              "description": "The unique ID of the user."
            },
            {
              "name": "betId",
              "description": "The unique ID of the bet."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/deposits/{depositId}",
        "definition": {
          "entityName": "Deposit",
          "schema": {
            "$ref": "#/backend/entities/Deposit"
          },
          "description": "Stores deposit requests made by each user. Path-based ownership enforces user creation.",
          "params": [
            {
              "name": "userId",
              "description": "The unique ID of the user."
            },
            {
              "name": "depositId",
              "description": "The unique ID of the deposit."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/withdrawals/{withdrawalId}",
        "definition": {
          "entityName": "Withdrawal",
          "schema": {
            "$ref": "#/backend/entities/Withdrawal"
          },
          "description": "Stores withdrawal requests made by each user. Path-based ownership enforces user creation.",
          "params": [
            {
              "name": "userId",
              "description": "The unique ID of the user."
            },
            {
              "name": "withdrawalId",
              "description": "The unique ID of the withdrawal."
            }
          ]
        }
      },
      {
        "path": "/roles_admin/{userId}",
        "definition": {
          "entityName": "admin",
          "schema": {
            "$ref": "#/backend/entities/User"
          },
          "description": "Uses existence over content to define admin roles. If a document exists for a user ID in this collection, that user is considered an admin.",
          "params": [
            {
              "name": "userId",
              "description": "The unique ID of the user."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore structure is designed to address the 'auth/operation-not-allowed' error, ensure security, scalability, and debuggability, and support the application's core features.  The error is likely due to Phone Authentication not being enabled in the Firebase Console.  The provided structure facilitates easy-to-write security rules and avoids hierarchical authorization dependencies by using path-based ownership and denormalization where needed.\n\n*   **/users/{userId}**:  This collection stores user data. Security rules will ensure that only the user can read/write their own document.\n*   **/game_rounds/{gameId}**: Stores the rounds of each game. Publicly readable, but write access restricted to admin.\n*   **/users/{userId}/bets/{betId}**: Stores the bets made by each user.  Path-based ownership ensures that only the user can read/write their own bets.\n*   **/users/{userId}/deposits/{depositId}**: Stores deposit requests made by each user.  Path-based ownership ensures only the user can create deposit requests.  Admin will have read/write access to approve/reject.\n*   **/users/{userId}/withdrawals/{withdrawalId}**: Stores withdrawal requests made by each user. Path-based ownership ensures only the user can create withdrawal requests.  Admin will have read/write access to approve/reject.\n*   **/roles_admin/{userId}**: Uses Existence over Content for identifying admins. If a document exists for a `userId` in this collection, that user is an admin.\n\n**Authorization Independence:**\n\nAuthorization independence is achieved using path-based ownership for `bets`, `deposits`, and `withdrawals`. This means that authorization checks do not need to `get()` data from parent documents. For example, the security rule for `/users/{userId}/bets/{betId}` can directly check if `request.auth.uid == userId` without needing to fetch the user document.\n\n**QAPs (Rules are not Filters):**\n\nThe structure is designed to avoid using rules as filters.  For example, listing bets is always done within the context of a user (`/users/{userId}/bets`).  Listing deposits and withdrawals is similar, ensuring that rules can efficiently and securely control access to the data without inefficient filtering.\n\n**Admin Role:**\nThe admin role is implemented using the \"Existence over Content\" strategy with the `/roles_admin/{userId}` collection. This means a user is an admin if and only if a document exists for their `userId` in this collection. This is efficient and secure for checking admin status in security rules."
  }
}