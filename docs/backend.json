{
  "entities": {
    "User": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "User",
      "type": "object",
      "description": "Represents a user of the Tiranga game.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the user entity."
        },
        "phone": {
          "type": "string",
          "description": "User's phone number."
        },
        "emailId": {
          "type": "string",
          "description": "Unique, email-like user ID (e.g., user123@tiranga.in)."
        },
        "balance": {
          "type": "number",
          "description": "User's wallet balance."
        },
        "name": {
          "type": "string",
          "description": "User's name."
        },
        "createdAt": {
          "type": "string",
          "description": "Timestamp of when the user was created.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "phone",
        "emailId",
        "balance",
        "createdAt"
      ]
    },
    "GameRound": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "GameRound",
      "type": "object",
      "description": "Represents a single round of a game.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the game round entity."
        },
        "gameType": {
          "type": "string",
          "description": "Type of game (e.g., wingo1, wingo3)."
        },
        "startTime": {
          "type": "string",
          "description": "Timestamp of when the game round started.",
          "format": "date-time"
        },
        "resultNumber": {
          "type": "number",
          "description": "Resulting number of the game round (0-9)."
        },
        "resultColor": {
          "type": "string",
          "description": "Resulting color of the game round (green, orange, white)."
        },
        "status": {
          "type": "string",
          "description": "Status of the game round (betting, locked, finished)."
        }
      },
      "required": [
        "id",
        "gameType",
        "startTime",
        "resultNumber",
        "resultColor",
        "status"
      ]
    },
    "Bet": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Bet",
      "type": "object",
      "description": "Represents a single bet placed by a user.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the bet entity."
        },
        "userId": {
          "type": "string",
          "description": "Reference to User. (Relationship: User 1:N Bet)"
        },
        "roundId": {
          "type": "string",
          "description": "Reference to GameRound. (Relationship: GameRound 1:N Bet)"
        },
        "choice": {
          "type": "string",
          "description": "User's bet choice (e.g., color:green, number:5, big)."
        },
        "amount": {
          "type": "number",
          "description": "Amount of the bet."
        },
        "multiplier": {
          "type": "number",
          "description": "Multiplier applied to the bet."
        },
        "won": {
          "type": "boolean",
          "description": "Indicates whether the bet was won or lost."
        },
        "payout": {
          "type": "number",
          "description": "Amount paid out for the bet."
        }
      },
      "required": [
        "id",
        "userId",
        "roundId",
        "choice",
        "amount",
        "multiplier",
        "won",
        "payout"
      ]
    },
    "Deposit": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Deposit",
      "type": "object",
      "description": "Represents a user's deposit request.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the deposit entity."
        },
        "userId": {
          "type": "string",
          "description": "Reference to User. (Relationship: User 1:N Deposit)"
        },
        "amount": {
          "type": "number",
          "description": "Amount of the deposit request."
        },
        "status": {
          "type": "string",
          "description": "Status of the deposit request (pending, approved, rejected)."
        },
        "screenshotUrl": {
          "type": "string",
          "description": "URL of the deposit screenshot."
        },
        "requestedAt": {
          "type": "string",
          "description": "Timestamp of when the deposit was requested.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "userId",
        "amount",
        "status",
        "screenshotUrl",
        "requestedAt"
      ]
    },
    "Withdrawal": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Withdrawal",
      "type": "object",
      "description": "Represents a user's withdrawal request.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the withdrawal entity."
        },
        "userId": {
          "type": "string",
          "description": "Reference to User. (Relationship: User 1:N Withdrawal)"
        },
        "amount": {
          "type": "number",
          "description": "Amount of the withdrawal request."
        },
        "upiBank": {
          "type": "string",
          "description": "UPI ID or bank details for the withdrawal."
        },
        "status": {
          "type": "string",
          "description": "Status of the withdrawal request (pending, approved, rejected)."
        },
        "requestedAt": {
          "type": "string",
          "description": "Timestamp of when the withdrawal was requested.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "userId",
        "amount",
        "upiBank",
        "status",
        "requestedAt"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/users/{userId}",
        "definition": {
          "entityName": "User",
          "schema": {
            "$ref": "#/backend/entities/User"
          },
          "description": "Stores user profiles. Uses Path-Based ownership for easy user data management. Includes the user's profile information, wallet balance, and creation timestamp.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for each user."
            }
          ]
        }
      },
      {
        "path": "/game_rounds/{gameRoundId}",
        "definition": {
          "entityName": "GameRound",
          "schema": {
            "$ref": "#/backend/entities/GameRound"
          },
          "description": "Stores information about each game round, including game type, start time, result, and status. Game rounds are globally accessible and do not require denormalized authorization fields.",
          "params": [
            {
              "name": "gameRoundId",
              "description": "The unique identifier for each game round."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/bets/{betId}",
        "definition": {
          "entityName": "Bet",
          "schema": {
            "$ref": "#/backend/entities/Bet"
          },
          "description": "Stores bets placed by each user. Uses Path-Based ownership for security. Includes denormalized 'userId' for authorization independence.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for each user."
            },
            {
              "name": "betId",
              "description": "The unique identifier for each bet."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/deposits/{depositId}",
        "definition": {
          "entityName": "Deposit",
          "schema": {
            "$ref": "#/backend/entities/Deposit"
          },
          "description": "Stores deposit requests made by each user. Uses Path-Based ownership for security. Includes denormalized 'userId' for authorization independence.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for each user."
            },
            {
              "name": "depositId",
              "description": "The unique identifier for each deposit."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/withdrawals/{withdrawalId}",
        "definition": {
          "entityName": "Withdrawal",
          "schema": {
            "$ref": "#/backend/entities/Withdrawal"
          },
          "description": "Stores withdrawal requests made by each user. Uses Path-Based ownership for security. Includes denormalized 'userId' for authorization independence.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for each user."
            },
            {
              "name": "withdrawalId",
              "description": "The unique identifier for each withdrawal."
            }
          ]
        }
      },
      {
        "path": "/admins/{adminId}",
        "definition": {
          "entityName": "admin",
          "schema": {
            "$ref": "#/backend/entities/User"
          },
          "description": "Collection of admin user IDs for role-based access control.",
          "params": [
            {
              "name": "adminId",
              "description": "The unique identifier for each admin."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore data structure is designed to support the Tiranga color prediction game, focusing on user data, game rounds, bets, deposits, and withdrawals.  It prioritizes Authorization Independence (CRITICAL), Clarity of Intent (Debuggability), DBAC (No Custom Claims), QAPs (Rules are not Filters), and Invariants.  The key principle applied is Authorization Independence via Denormalization, to avoid hierarchical authorization dependencies (get()). Path-Based Ownership is used for user-owned data (users, bets, deposits, withdrawals) to simplify security rules. The structure facilitates secure `list` operations (QAPs) by ensuring that each collection contains documents with homogeneous security needs. For example, bets are stored under users, allowing easy listing of a user's bets, while game rounds are global and require no `get()` calls for validation of bets during write operations.\n\nSpecifically, for the 'bets' subcollection under each user, the `userId` field is redundant but maintained to enhance security rule clarity and potential filtering needs. Denormalization of 'members' is not required in this specific implementation as collaborative aspects, and global roles are managed through the admin panel using a dedicated 'admins' collection."
  }
}